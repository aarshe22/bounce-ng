RewriteEngine On
RewriteBase /

# Skip rewriting if the file exists (must be first)
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Skip rewriting if the directory exists
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Remove trailing slashes (except for root)
RewriteCond %{REQUEST_URI} (.+)/$
RewriteRule ^ %1 [R=301,L]

# Handle auth callback routes - map /auth/google/callback to /auth/google/callback.php
RewriteCond %{REQUEST_URI} ^/auth/([^/]+)/callback$ [NC]
RewriteCond %{DOCUMENT_ROOT}/auth/$1/callback.php -f
RewriteRule ^auth/([^/]+)/callback$ /auth/$1/callback.php [L]

# Handle auth routes - map /auth/google to /auth/google.php (must come after callback)
RewriteCond %{REQUEST_URI} ^/auth/([^/]+)$ [NC]
RewriteCond %{DOCUMENT_ROOT}/auth/$1.php -f
RewriteRule ^auth/([^/]+)$ /auth/$1.php [L]

# Handle api routes - map /api/endpoint to /api/endpoint.php if file exists
RewriteCond %{REQUEST_URI} ^/api/([^/]+)$ [NC]
RewriteCond %{DOCUMENT_ROOT}/api/$1.php -f
RewriteRule ^api/([^/]+)$ /api/$1.php [L]

# Skip rewriting for specific file paths
RewriteCond %{REQUEST_URI} ^/(login\.php|logout\.php|init\.php|oauth-callback\.php|public/) [NC]
RewriteRule ^ - [L]

# Serve static files from public directory
RewriteCond %{REQUEST_URI} ^/(app\.js|styles\.css)$ [NC]
RewriteCond %{DOCUMENT_ROOT}/public%{REQUEST_URI} -f
RewriteRule ^(.*)$ /public/$1 [L]

# For all other requests, serve index.php (SPA)
RewriteRule ^(.*)$ /index.php [L]

